<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>XySSL: ssl_v3.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>ssl_v3.h</h1><a href="ssl__v3_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00004 <span class="preprocessor">#ifndef _SSL_V3_H</span>
00005 <span class="preprocessor"></span><span class="preprocessor">#define _SSL_V3_H</span>
00006 <span class="preprocessor"></span>
00007 <span class="preprocessor">#ifdef __cplusplus</span>
00008 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00009 <span class="preprocessor">#endif</span>
00010 <span class="preprocessor"></span>
00011 <span class="preprocessor">#ifndef _STD_TYPES</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#define _STD_TYPES</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#define uchar   unsigned char</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define uint    unsigned int</span>
00016 <span class="preprocessor"></span><span class="preprocessor">#define ulong   unsigned long int</span>
00017 <span class="preprocessor"></span>
00018 <span class="preprocessor">#endif</span>
00019 <span class="preprocessor"></span>
00020 <span class="preprocessor">#define ERR_SSL_INVALID_MAC                     0x0500</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_INVALID_RECORD                  0x0520</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_INVALID_MODULUS_SIZE            0x0540</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_UNKNOWN_CIPHER                  0x0560</span>
00024 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_NO_CIPHER_ACCEPTABLE            0x0580</span>
00025 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_CERTIFICATE_TOO_LARGE           0x05A0</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_CERTIFICATE_REQUIRED            0x05C0</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_PRIVATE_KEY_REQUIRED            0x05E0</span>
00028 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_CA_CHAIN_REQUIRED               0x0600</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_UNEXPECTED_MESSAGE              0x0620</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_FATAL_ALERT_MESSAGE             0x0640</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_PEER_VERIFY_FAILED              0x0660</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_PEER_CLOSE_NOTIFY               0x0680</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_BAD_HS_CLIENT_HELLO             0x06A0</span>
00034 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_BAD_HS_SERVER_HELLO             0x06C0</span>
00035 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_BAD_HS_CERTIFICATE              0x06E0</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_BAD_HS_CERTIFICATE_REQUEST      0x0700</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_BAD_HS_SERVER_KEY_EXCHANGE      0x0720</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_BAD_HS_SERVER_HELLO_DONE        0x0740</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_BAD_HS_CLIENT_KEY_EXCHANGE      0x0760</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_BAD_HS_CERTIFICATE_VERIFY       0x0780</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_BAD_HS_CHANGE_CIPHER_SPEC       0x07A0</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define ERR_SSL_BAD_HS_FINISHED                 0x07C0</span>
00043 <span class="preprocessor"></span>
00044 <span class="comment">/*</span>
00045 <span class="comment"> * Supported ciphersuites</span>
00046 <span class="comment"> */</span>
00047 <span class="preprocessor">#define SSL3_RSA_RC4_128_MD5            4</span>
00048 <span class="preprocessor"></span><span class="preprocessor">#define SSL3_RSA_RC4_128_SHA            5</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#define SSL3_RSA_DES_168_SHA           10</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#define SSL3_EDH_RSA_DES_168_SHA       22</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#define TLS1_RSA_AES_256_SHA           53</span>
00052 <span class="preprocessor"></span><span class="preprocessor">#define TLS1_EDH_RSA_AES_256_SHA       57</span>
00053 <span class="preprocessor"></span>
00054 <span class="comment">/*</span>
00055 <span class="comment"> * Various constants</span>
00056 <span class="comment"> */</span>
00057 <span class="preprocessor">#define SSLV3_MAJOR_VERSION             3</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#define SSLV3_MINOR_VERSION             0</span>
00059 <span class="preprocessor"></span><span class="preprocessor">#define TLS10_MINOR_VERSION             1</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#define TLS11_MINOR_VERSION             2</span>
00061 <span class="preprocessor"></span>
00062 <span class="preprocessor">#define SSL_MAX_RECORD_LEN          16384</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#define SSL_COMPRESS_NULL               0</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#define SSL_IS_CLIENT                   0</span>
00065 <span class="preprocessor"></span><span class="preprocessor">#define SSL_IS_SERVER                   1</span>
00066 <span class="preprocessor"></span>
00067 <span class="preprocessor">#define SSL_VERIFY_NONE                 0</span>
00068 <span class="preprocessor"></span><span class="preprocessor">#define SSL_VERIFY_OPTIONAL             1</span>
00069 <span class="preprocessor"></span><span class="preprocessor">#define SSL_VERIFY_REQUIRED             2</span>
00070 <span class="preprocessor"></span>
00071 <span class="comment">/*</span>
00072 <span class="comment"> * Message, alert and handshake types</span>
00073 <span class="comment"> */</span>
00074 <span class="preprocessor">#define SSL_MSG_CHANGE_CIPHER_SPEC     20</span>
00075 <span class="preprocessor"></span><span class="preprocessor">#define SSL_MSG_ALERT                  21</span>
00076 <span class="preprocessor"></span><span class="preprocessor">#define SSL_MSG_HANDSHAKE              22</span>
00077 <span class="preprocessor"></span><span class="preprocessor">#define SSL_MSG_APPLICATION_DATA       23</span>
00078 <span class="preprocessor"></span>
00079 <span class="preprocessor">#define SSL_ALERT_CLOSE_NOTIFY          0</span>
00080 <span class="preprocessor"></span><span class="preprocessor">#define SSL_ALERT_WARNING               1</span>
00081 <span class="preprocessor"></span><span class="preprocessor">#define SSL_ALERT_FATAL                 2</span>
00082 <span class="preprocessor"></span>
00083 <span class="preprocessor">#define SSL_HS_HELLO_REQUEST            0</span>
00084 <span class="preprocessor"></span><span class="preprocessor">#define SSL_HS_CLIENT_HELLO             1</span>
00085 <span class="preprocessor"></span><span class="preprocessor">#define SSL_HS_SERVER_HELLO             2</span>
00086 <span class="preprocessor"></span><span class="preprocessor">#define SSL_HS_CERTIFICATE             11</span>
00087 <span class="preprocessor"></span><span class="preprocessor">#define SSL_HS_SERVER_KEY_EXCHANGE     12</span>
00088 <span class="preprocessor"></span><span class="preprocessor">#define SSL_HS_CERTIFICATE_REQUEST     13</span>
00089 <span class="preprocessor"></span><span class="preprocessor">#define SSL_HS_SERVER_HELLO_DONE       14</span>
00090 <span class="preprocessor"></span><span class="preprocessor">#define SSL_HS_CERTIFICATE_VERIFY      15</span>
00091 <span class="preprocessor"></span><span class="preprocessor">#define SSL_HS_CLIENT_KEY_EXCHANGE     16</span>
00092 <span class="preprocessor"></span><span class="preprocessor">#define SSL_HS_FINISHED                20</span>
00093 <span class="preprocessor"></span>
00094 <span class="preprocessor">#include "<a class="code" href="sha1_8h.html">sha1.h</a>"</span>
00095 <span class="preprocessor">#include "<a class="code" href="md5_8h.html">md5.h</a>"</span>
00096 <span class="preprocessor">#include "<a class="code" href="rsa_8h.html">rsa.h</a>"</span>
00097 <span class="preprocessor">#include "<a class="code" href="dhm_8h.html">dhm.h</a>"</span>
00098 <span class="preprocessor">#include "<a class="code" href="x509_8h.html">x509.h</a>"</span>
00099 
00100 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00101 <span class="keyword"></span>{
00102     uchar max_ver[2];   
00104     <span class="comment">/*</span>
00105 <span class="comment">     * Negotiated protocol version</span>
00106 <span class="comment">     */</span>
00107     <span class="keywordtype">int</span> major_version;  
00108     <span class="keywordtype">int</span> minor_version;  
00110     <span class="comment">/*</span>
00111 <span class="comment">     * Record layer -- incoming data</span>
00112 <span class="comment">     */</span>
00113     <span class="keywordtype">int</span> read_fd;        
00115     <span class="keywordtype">int</span> in_msgtype;     
00116     <span class="keywordtype">int</span> in_msglen;      
00117     <span class="keywordtype">int</span> in_prvlen;      
00118     uchar in_alert[2];  
00120     uchar *in_ctr;      
00121     uchar *in_hdr;      
00122     uchar *in_msg;      
00124     <span class="keywordtype">int</span> in_offt;        
00125     <span class="keywordtype">int</span> in_left;        
00127     <span class="comment">/*</span>
00128 <span class="comment">     * Record layer -- outgoing data</span>
00129 <span class="comment">     */</span>
00130     <span class="keywordtype">int</span> write_fd;       
00132     <span class="keywordtype">int</span> out_msgtype;    
00133     <span class="keywordtype">int</span> out_msglen;     
00135     uchar *out_ctr;     
00136     uchar *out_hdr;     
00137     uchar *out_msg;     
00139     <span class="comment">/*</span>
00140 <span class="comment">     * PKI stuff</span>
00141 <span class="comment">     */</span>
00142     rsa_context *own_key;       
00143     x509_cert *own_cert;        
00144     x509_cert *ca_chain;        
00145     x509_cert *peer_cert;       
00146     <span class="keywordtype">char</span> *peer_cn;              
00148     <span class="keywordtype">int</span> endpoint;               
00149     <span class="keywordtype">int</span> client_auth;            
00150     <span class="keywordtype">int</span> verify_mode;            
00151     <span class="keywordtype">int</span> verify_result;          
00153     <span class="comment">/*</span>
00154 <span class="comment">     * Crypto stuff</span>
00155 <span class="comment">     */</span>
00156      <a class="code" href="structmd5__context.html">md5_context</a> hs_md5;        
00157     <a class="code" href="structsha1__context.html">sha1_context</a> hs_sha1;       
00158     <span class="keywordtype">int</span> hslen;                  
00160     ulong (*rng_func)(<span class="keywordtype">void</span> *);  
00161     <span class="keywordtype">void</span> *rng_state;            
00162     dhm_context dhm_ctx;        
00163     uchar randbytes[64];        
00164     uchar premaster[256];       
00165     uchar master[48];           
00167     <span class="keywordtype">int</span> *cipherlist;            
00168     <span class="keywordtype">int</span> cipher;                 
00169     <span class="keywordtype">int</span> minlen;                 
00170     <span class="keywordtype">int</span> ctxlen;                 
00171     <span class="keywordtype">void</span> *encrypt_ctx;          
00172     <span class="keywordtype">void</span> *decrypt_ctx;          
00174     <span class="keywordtype">int</span> ivlen;                  
00175     uchar iv_enc[16];           
00176     uchar iv_dec[16];           
00178     <span class="keywordtype">int</span> maclen;                 
00179     uchar mac_enc[32];          
00180     uchar mac_dec[32];          
00181 }
00182 ssl_context;
00183 
00184 <span class="comment">/*</span>
00185 <span class="comment"> * Internal functions (do not call directly)</span>
00186 <span class="comment"> */</span>
00187 <span class="keywordtype">int</span> ssl_read_record(  ssl_context *ssl, <span class="keywordtype">int</span> do_crypt );
00188 <span class="keywordtype">int</span> ssl_write_record( ssl_context *ssl, <span class="keywordtype">int</span> do_crypt );
00189 
00190 <span class="keywordtype">int</span> ssl_parse_certificate( ssl_context *ssl );
00191 <span class="keywordtype">int</span> ssl_write_certificate( ssl_context *ssl );
00192 
00193 <span class="keywordtype">int</span> ssl_parse_change_cipher_spec( ssl_context *ssl );
00194 <span class="keywordtype">int</span> ssl_write_change_cipher_spec( ssl_context *ssl );
00195 
00196 <span class="keywordtype">int</span> ssl_derive_keys( ssl_context *ssl );
00197 
00198 <span class="keywordtype">int</span> ssl_parse_finished( ssl_context *ssl );
00199 <span class="keywordtype">int</span> ssl_write_finished( ssl_context *ssl );
00200 
00208 <span class="keywordtype">int</span> <a class="code" href="ssl__v3_8h.html#a69">ssl_init</a>( ssl_context *ssl, <span class="keywordtype">int</span> *cipherlist,
00209               ulong (*rng_func)(<span class="keywordtype">void</span> *), <span class="keywordtype">void</span> *rng_state );
00210 
00214 <span class="keywordtype">int</span> <a class="code" href="ssl__v3_8h.html#a70">ssl_set_io_files</a>( ssl_context *ssl, <span class="keywordtype">int</span> read_fd, <span class="keywordtype">int</span> write_fd );
00215 
00219 <span class="keywordtype">int</span> <a class="code" href="ssl__v3_8h.html#a71">ssl_set_own_cert</a>( ssl_context *ssl, x509_cert *own_cert,
00220                       rsa_context *own_key );
00221 
00226 <span class="keywordtype">int</span> <a class="code" href="ssl__v3_8h.html#a72">ssl_set_ca_chain</a>( ssl_context *ssl, x509_cert *ca, <span class="keywordtype">char</span> *cn );
00227 
00231 <span class="keywordtype">char</span> *<a class="code" href="ssl__v3_8h.html#a73">ssl_cipher_name</a>( ssl_context *ssl );
00232 
00250 <span class="keywordtype">int</span> <a class="code" href="ssl__v3_8h.html#a74">ssl_client_start</a>( ssl_context *ssl, <span class="keywordtype">int</span> server_verify );
00251 
00269 <span class="keywordtype">int</span> <a class="code" href="ssl__v3_8h.html#a75">ssl_server_start</a>( ssl_context *ssl, <span class="keywordtype">int</span> client_verify );
00270 
00279 <span class="keywordtype">int</span> <a class="code" href="ssl__v3_8h.html#a76">ssl_read</a>( ssl_context *ssl, uchar *buf, <span class="keywordtype">int</span> *len, <span class="keywordtype">int</span> full );
00280 
00285 <span class="keywordtype">int</span> <a class="code" href="ssl__v3_8h.html#a77">ssl_write</a>( ssl_context *ssl, uchar *buf, <span class="keywordtype">int</span> len );
00286 
00290 <span class="keywordtype">void</span> <a class="code" href="ssl__v3_8h.html#a78">ssl_close</a>( ssl_context *ssl );
00291 
00292 <span class="preprocessor">#ifdef __cplusplus</span>
00293 <span class="preprocessor"></span>}
00294 <span class="preprocessor">#endif</span>
00295 <span class="preprocessor"></span>
00296 <span class="preprocessor">#endif </span><span class="comment">/* ssl_v3.h */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Feb 1 10:52:59 2007 for XySSL by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
